---
layout: default
title: ROLLBACK DELTA
nav_order: 41
parent: Запросы SQL+
grand_parent: Справочная информация
has_children: false
has_toc: false
---

# ROLLBACK DELTA

Запрос позволяет откатить горячую (открытую) [дельту](../../../overview/main_concepts/delta/delta.md).
Отменяются следующие операции записи дельты:
* все завершенные [операции записи](../../../overview/main_concepts/write_operation/write_operation.md),
* незавершенные операции записи, запущенные запросами [загрузки данных](../../../working_with_system/data_upload/data_upload.md).

Перед выполнением запроса необходимо определить логическую базу данных,
[используемую по умолчанию](../../../working_with_system/other_features/default_db_set-up/default_db_set-up.md),
если она еще не определена.

После выполнения запроса невозможно закрыть дельту, даже если попытка была неуспешной и запрос вернул исключение.
{: .warning-wrapper}

Запрос `ROLLBACK DELTA` не отменяет незавершенные операции записи, запущенные запросами [обновления данных](../../../working_with_system/data_update/data_update.md).
<br>Операции закрытой дельты отменить невозможно.
{: .note-wrapper}

Откат горячей дельты выполняется в следующем порядке:
1. Останавливаются незавершенные операции записи, запущенные запросами [загрузки данных](../../../working_with_system/data_upload/data_upload.md).
   <br>Операции останавливаются асинхронно, поэтому система с заданной периодичностью проверяет, остались ли неостановленные операции. 
   Периодичность проверки регулируется параметром [конфигурации](../../../maintenance/configuration/system/system.md) 
   `DELTA_ROLLBACK_STATUS_CALLS_MS`.
2. Отменяются операции горячей дельты: 
   * все завершенные операции,
   * операции, остановленные на шаге 1.
3. Горячая дельта удаляется из [сервисной базы данных](../../../overview/main_concepts/service_db/service_db.md). 
   Зарезервированный ранее номер горячей дельты освобождается.

В ответе возвращается:
*   объект ResultSet c одной записью, содержащей номер последней закрытой дельты, при успешном выполнении запроса;
*   исключение при неуспешном выполнении запроса.

После успешного выполнения запроса становится доступно изменение [логической схемы данных](../../../overview/main_concepts/logical_schema/logical_schema.md):
создание, удаление и изменение таблиц и представлений.

Система не гарантирует остановку и отмену всех операций за один вызов. Если запрос вернул ошибку 
`Can't rollback delta by datamart <db_name>`, это означает, что некоторые операции не были отменены и нужно повторить запрос.
{: .note-wrapper}

Горячую дельту невозможно откатить или закрыть, пока в ней есть незавершенные операции записи. Способы обработки
таких операций см. в разделе
[Управление операциями записи](../../../working_with_system/operation_management/write_op_management/write_op_management.md).
<br>Наличие незавершенных операций записи можно проверить с помощью запроса
[GET_WRITE_OPERATIONS](../GET_WRITE_OPERATIONS/GET_WRITE_OPERATIONS.md).
{: .note-wrapper}

## Синтаксис {#syntax}

```sql
ROLLBACK DELTA
```