---
layout: default
title: ROLLBACK DELTA
nav_order: 41
parent: Запросы SQL+
grand_parent: Справочная информация
has_children: false
has_toc: false
---

# ROLLBACK DELTA

Запрос позволяет откатить горячую (открытую) [дельту](../../../overview/main_concepts/delta/delta.md).
Отменяются следующие операции записи дельты:
* все завершенные [операции записи](../../../overview/main_concepts/write_operation/write_operation.md),
* незавершенные операции записи, запущенные запросами [загрузки данных](../../../working_with_system/data_upload/data_upload.md).

Перед выполнением запроса необходимо определить логическую базу данных,
[используемую по умолчанию](../../../working_with_system/other_features/default_db_set-up/default_db_set-up.md),
если она еще не определена.

После выполнения запроса невозможно закрыть дельту, даже если попытка была неуспешной и запрос вернул исключение.
{: .warning-wrapper}

Невозможен откат незавершенных операций записи, запущенных запросами [обновления данных](../../../working_with_system/data_update/data_update.md). 
Для отката таких операций нужно дождаться их завершения и выполнить запрос `ROLLBACK DELTA`.
<br>В закрытой дельте невозможен откат любых операций.
{: .note-wrapper}

Откат горячей дельты выполняется в следующем порядке:
1. Останавливаются незавершенные операции записи, запущенные запросами [загрузки данных](../../../working_with_system/data_upload/data_upload.md).
   <br>Операции останавливаются асинхронно, поэтому система с заданной периодичность проверяет, остались ли неостановленные операции. 
   Периодичность проверки регулируется параметром [конфигурации](../../../maintenance/configuration/system/system.md) 
   `DELTA_ROLLBACK_STATUS_CALLS_MS`.
2. Отменяются операции горячей дельты: 
   * все завершенные операции,
   * операции из шага 1.
3. Горячая дельта удаляется из [сервисной базы данных](../../../overview/main_concepts/service_db/service_db.md). 
   Зарезервированный ранее номер горячей дельты освобождается.

В ответе возвращается:
*   объект ResultSet c одной записью, содержащей номер последней закрытой дельты, при успешном выполнении
    запроса;
*   исключение при неуспешном выполнении запроса.

После успешного выполнения запроса становится доступно изменение [логической схемы данных](../../../overview/main_concepts/logical_schema/logical_schema.md):
создание, удаление и изменение таблиц и представлений.

Система не гарантирует остановку и отмену всех операций за один вызов. Если запрос вернул ошибку 
`Can't rollback delta by datamart <db_name>`, это означает, что некоторые операции не были отменены и нужно повторить запрос.
{: .note-wrapper}

Дельту невозможно откатить, если зависла операция, запущенная запросом обновления данных. Если это произошло, 
перезапустите обработку операции — повторите запрос, который создал проблемную операцию. После выполнения запроса 
можно откатить дельту.
<br>Наличие зависших операций можно проверить запросом [GET_WRITE_OPERATIONS](../GET_WRITE_OPERATIONS/GET_WRITE_OPERATIONS.md).
{: .note-wrapper}

## Синтаксис {#syntax}

```sql
ROLLBACK DELTA
```