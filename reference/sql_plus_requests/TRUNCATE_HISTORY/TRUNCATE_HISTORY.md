---
layout: default
title: TRUNCATE HISTORY
nav_order: 41
parent: Запросы SQL+
grand_parent: Справочная информация
has_children: false
has_toc: false
---

# TRUNCATE HISTORY
{: .no_toc }

<details markdown="block">
  <summary>
    Содержание раздела
  </summary>
  {: .text-delta }
1. TOC
{:toc}
</details>

Запрос позволяет удалить записи [логической таблицы](../../../overview/main_concepts/logical_table/logical_table.md) 
согласно заданным условиям. В зависимости от параметров запроса удаляются записи одной из категорий:
*   записи таблицы, которые были перенесены в архив до указанного момента времени (включительно) и 
    соответствуют условию, заданному в запросе;
*   все архивные и актуальные записи таблицы, которые соответствуют условию, заданному в запросе.

Если в запросе указан момент времени, система определяет [дельту](../../../overview/main_concepts/delta/delta.md), 
которая являлась последней закрытой дельтой на тот момент, и удаляет все записи логической таблицы, 
которые стали архивными в эту дельту или ранее и соответствуют заданному условию. Иначе, если задано 
ключевое слово `infinite`, удаляются все записи таблицы, соответствующие условию.

В ответе возвращается:
*   пустой объект ResultSet при успешном выполнении запроса;
*   исключение при неуспешном выполнении запроса.

В результате успешного выполнения запроса записи, удовлетворяющие его параметрам, удаляются из логической 
таблицы.

Удаление данных с помощью `TRUNCATE HISTORY` не версионируется системой и не записывается в 
[журнал](../../../overview/main_concepts/changelog/changelog.md). Удаленные данные невозможно восстановить средствами 
системы.
{: .warning-wrapper}

На рисунке ниже показан пример работы запроса с указанным моментом времени. В примере есть три версии записи 
по одной торговой точке, загруженные в различные периоды года. В результате исполнения запроса с меткой времени
`'2021-04-10 01:00:00'` удаляется первая версия записи: на этот момент времени последней 
закрытой дельтой была дельта со второй версией записи и только первая версия записи была архивной.

![](truncate_history.svg)
{: .figure-center}
*Удаление архивной записи по запросу с меткой времени*
{: .figure-caption-center}

## Синтаксис {#syntax}

```sql
TRUNCATE HISTORY [db_name.]table_name FOR SYSTEM_TIME AS OF date_time_expression
[WHERE filter_expression]
```

Параметры:
*   `db_name` — имя логической базы данных. Указывается опционально, если выбрана логическая БД, 
    [используемая по умолчанию](../../../working_with_system/other_features/default_db_set-up/default_db_set-up.md);
*   `table_name` — имя логической таблицы, из которой удаляются записи;
*   `date_time_expression` — выражение, определяющее категорию удаляемых записей. Может принимать 
    следующие значения:
    *   `'YYYY-MM-DD hh:mm:ss'` — удаление архивных записей по указанный момент времени. Возможные форматы 
        см. в разделе [Форматы даты и времени](../../timestamp_formats/timestamp_formats.md);
    *   `'infinite'` — удаление всех актуальных и архивных записей;
*   `filter_expression` — условие выбора записей, подлежащих удалению.

## Ограничения {#restrictions}

Выполнение запроса недоступно в сервисной базе данных `INFORMATION_SCHEMA`.

## Пример {#examples}

Удаление архивных записей таблицы `sales`, в которых значение столбца `product_units` меньше `10`, 
по момент времени `'2019-12-23 15:15:14'`:
```sql
TRUNCATE HISTORY sales.sales FOR SYSTEM_TIME AS OF '2019-12-23 15:15:14'
WHERE product_units < 10
```
Удаление всех актуальных и архивных записей таблицы `stores`, в которых значение столбца 
`id` равно `123456`:
```sql
TRUNCATE HISTORY sales.stores FOR SYSTEM_TIME AS OF 'infinite'
WHERE id = 123456
```