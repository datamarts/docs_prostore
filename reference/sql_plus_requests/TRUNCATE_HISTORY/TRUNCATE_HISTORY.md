---
layout: default
title: TRUNCATE HISTORY
nav_order: 41
parent: Запросы SQL+
grand_parent: Справочная информация
has_children: false
has_toc: false
---

# TRUNCATE HISTORY
{: .no_toc }

<details markdown="block">
  <summary>
    Содержание раздела
  </summary>
  {: .text-delta }
1. TOC
{:toc}
</details>

Запрос позволяет очистить записи [логической таблицы](../../../overview/main_concepts/logical_table/logical_table.md) 
по условию. 
Записи удаляются окончательно и не подлежат восстановлению средствами системы.

Очищаются следующие записи:
* если в запросе указана метка времени — очищаются архивные записи таблицы, которые соответствуют условию и 
  стали архивными до последней закрытой на тот момент [дельты](../../../overview/main_concepts/delta/delta.md) (включительно);
* если в запросе указано ключевое слово `infinite` — очищаются архивные и актуальные записи таблицы, которые соответствуют 
  условию.

В ответе возвращается:
*   пустой объект ResultSet при успешном выполнении запроса;
*   исключение при неуспешном выполнении запроса.

В результате успешного выполнения запроса записи, удовлетворяющие его параметрам, удаляются из логической 
таблицы без возможности восстановления.

Очистка данных с помощью `TRUNCATE HISTORY` не версионируется системой и не записывается в 
[журнал](../../../overview/main_concepts/changelog/changelog.md). Данные, удаленные таким образом, невозможно 
восстановить средствами системы.
{: .warning-wrapper}

На рисунке ниже показан пример работы запроса, содержащего метку времени. В примере три версии записи 
по одной торговой точке загружены в разные периоды года. По запросу с меткой времени
`'2021-04-10 01:00:00'` очищается первая версия записи: на тот момент времени последней 
закрытой дельтой была дельта со второй версией записи и только первая версия записи была архивной.

![](truncate_history.svg)
{: .figure-center}
*Очистка архивной записи по запросу с меткой времени*
{: .figure-caption-center}

## Синтаксис {#syntax}

```sql
TRUNCATE HISTORY [db_name.]table_name FOR SYSTEM_TIME AS OF date_time_expression
[WHERE filter_expression]
```

Параметры:
*   `db_name` — имя логической базы данных. Опционально, если выбрана логическая БД, 
    [используемая по умолчанию](../../../working_with_system/other_features/default_db_set-up/default_db_set-up.md);
*   `table_name` — имя очищаемой логической таблицы;
*   `date_time_expression` — выражение, определяющее категорию очищаемых записей. Может принимать 
    следующие значения:
    *   `'YYYY-MM-DD hh:mm:ss'` — очистка архивных записей старше указанного момента времени. Возможные форматы 
        см. в разделе [Форматы даты и времени](../../timestamp_formats/timestamp_formats.md);
    *   `'infinite'` — очистка актуальных и архивных записей;
*   `filter_expression` — условие выбора очищаемых записей.

## Ограничения {#restrictions}

Выполнение запроса недоступно в сервисной базе данных `INFORMATION_SCHEMA`.

## Пример {#examples}

Очистка архивных записей таблицы `sales`, в которых значение столбца `product_units` меньше `10`, 
по момент времени `'2019-12-23 15:15:14'`:
```sql
TRUNCATE HISTORY sales.sales FOR SYSTEM_TIME AS OF '2019-12-23 15:15:14'
WHERE product_units < 10
```
Очистка актуальных и архивных записей таблицы `stores`, в которых значение столбца 
`id` равно `123456`:
```sql
TRUNCATE HISTORY sales.stores FOR SYSTEM_TIME AS OF 'infinite'
WHERE id = 123456
```